###使用计数式复制控制  

复制控制成员适当地操纵使用计数和指针，复制对象包括复制两个指针和使用计数加1，析构函数将使用计数减1。如果计数减至0的时候就撤销指针，因为赋值操作符要完成同样的工作，所以在私有的析构函数中要实现析构函数的行为。  

句柄类通常需要在不知道对象确切类型分配对象类型，为了解决这个问题，所以通常的方式是定义虚函数进行复制，我们称之为该函数为clone。  

为了句柄类，我们需要从基类开始，在继承层次的每一个类中都增加clone，基类必须将该函数定义为虚函数，如以下的代码所示：  

```java
	class Base{
		public:
			virtual Base* clone() const {
				return new Base(*this);	
			}
	}
每个类都需要重新定义该虚函数，因为函数的存在是为了生成类对象的副本，所以定义返回类型为类本身
类似于java中实现的clone函数。
	
	*的作用为解引用
	class Subclass : public Base{
		public :
			Subclass* clone() const {
				return new Subclass(*this);
			}
	}
```

###定义句柄的构造函数

一旦有了clone函数，就可以这样编写句柄类，如以下代码所示：  

```java
	Sales_item::Sales_item(const Base &item):p(item.clone()),
	use(new std::size_t(1)){}
	像默认的构造函数一样，构造函数分配并且初始化使用计数，调用形参的clone产生那个对象的虚副本。
	如果实参是Base对象，则运行实参的clone函数。如果是派生类的话则运行的是派生类clone函数。
```

###使用带关联容器的比较器

如果使用比较函数，必须作为容器的部分而存储，任何在容器中增加或者查找元素的操作都要使用比较函数。原则上，每个这个的操作都接受一个可选的附加实参，表示比较函数，但是如果两个操作使用不同的比较函数，可能顺序不一样，也就不能预测实际发生什么。  

类似的对于添加到容器中需要实现在java中的compare函数。通过将比较函数存储在容器中，保证每一个元素的操作都将一致的进行，基于同样的理由，容器需要知道元素的类型，为了存储比较器，需要知道比较器的类型，原则上，通过假定比较器是一个函数指针，函数接受key_type类型的对象并且返回bool值，容器可以判断出这个类型，不幸的是，这个推断出的类型可能限制太大，首先应该允许比较器是函数对象或者普通函数。所以使用比较函数，必须指定比较器类型，比较器类型是接受一个引用类型，并且返回bool值的函数。如下代码所示：  

```java
	typedof bool (*Comp) (const Base& ,const Base&);
	//这个语句将Comp定义为函数类型指针的同义词，该函数类型与我们希望用来比较Base对象的比较函数相匹配。  
	接下来需要定义multiset<Base ,Comp> items(compare);  
	//代码的意思为items是一个multiset,它保存了Base对象并且使用了Com类型的对象来比较们
	multiset是空的--我们没有提供任何的元素，但是我们提供了一个为compare的比较函数。当在      
    items中增加或者查找元素的时候，将使用compare函数对元素进行排序。
```

###使用句柄至执行虚函数  

在句柄里面执行虚函数，可以调用父类的虚函数方法来进行处理。对指针或者是iter解引用可以获得对象，所以实际上最终的处理数据将取决于子类实现虚函数的方式。  

###抽象接口类

本例子利用TextQuery进行查询，代码如下所示：  
 
抽象的基类为Query_base,它的作用是作为查询继承层次的根，直接从抽象基类派生WordQuery和NoteQuery，将基本的操作定义为纯虚函数，每个派生类都必须对这些函数定义自己的版本。  

###值型句柄  

程序将处理计算查询，而不是建立查询，但是需要能够创立查询以便能够运行程序，最简单的办法是编写c++直接创建查询，例如可以编写这样的代码：  
```java
	Query q=Query("friend") & Query("bird") | Query("wind");
	//借此语句产生前面的复合查询
```
这个问题描述暗示我们：用户级的代码将不能直接使用我们的继承层次。相反，我们需要定义一个Query句柄类，以此来隐藏继承层次，用户将根据句柄执行，用户代码只能间接的操作Query_base对象。使用指针保存管理对象，使用计数器来管理句柄指向的对象。 

###含有纯虚函数的类叫做抽象类 


